\documentclass[aspectratio=1610, 10pt]{beamer}
\usepackage[english]{babel}
\usepackage{amsmath, amsthm, subfiles, bm, hyperref, graphicx}
\usepackage{caption, longtable, booktabs}
\usepackage{cancel}

% my cmd
%%%%%%%%%%%%%%%%
% start my commands
%%%%%%%%%%%%%%%%
\newcommand{\lm}{\lambda_\textrm{max}}
\newcommand{\trace}{\mathbf{trace}}
\newcommand{\diag}{\mathbf{diag}}
\newcommand{\model}[1]{(\textbf{#1})}
\newcommand{\mx}{\mathbf{\max}\;}
\newcommand{\mn}{\mathbf{\min}\;}
\newcommand{\st}{\mathrm{s.t.\;}}
\newcommand{\ex}{\mathbf E}
\newcommand{\dx}{\;\bm dx}
\newcommand{\pr}{\mathbf P}
\newcommand{\id}{\mathbf I}
\newcommand{\bp}{\mathbb P}
\newcommand{\be}{\mathbb E}
\newcommand{\bi}{\mathbb I}
\newcommand{\bxi}{{\bm \xi}}
\newcommand{\va}{\mathbf{Var}}
\newcommand{\dif}{\mathbf{d}}
\newcommand{\minp}[2]{\min\{#1, #2\}}
\newcommand{\intp}{\mathbf{int}}
\newcommand{\apex}{\mathbf{apex}}
\newcommand{\conv}{\mathbf{conv}}
\newcommand{\red}[1]{\textcolor{red}{#1}}
\usefonttheme[onlymath]{serif}

%%%%%%%%%%%%%%%%
% finish my commands
%%%%%%%%%%%%%%%%

% theorem environments
\setbeamertemplate{footline}[frame number]


\makeatletter
\patchcmd{\beamer@sectionintoc}
{\ifnum\beamer@tempcount>0}
{\ifnum\beamer@tempcount>-1}
{}
{}
\beamer@tocsectionnumber=0
\makeatother

% set the toc to be using the number
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

\hypersetup{pdfstartview={Fit}}

\AtBeginSection[]
{
    \begin{frame}
        \frametitle{Table of Contents}
        \tableofcontents[        currentsection,         currentsubsection,         subsectionstyle=show/shaded/hide,]
    \end{frame}
}


\defbeamertemplate{section page}{mine}[1][]{%
    \begin{centering}
        \vskip1em\par
        \begin{beamercolorbox}[sep=12pt, center]{part title}
            \usebeamerfont{section title}\insertsection\par
        \end{beamercolorbox}
    \end{centering}
}

\defbeamertemplate{subsection page}{mine}[1][]
{
    \begingroup
    \begin{beamercolorbox}[sep=8pt, center]{subsection title}
        \usebeamerfont{subsection title}\insertsubsection\par
    \end{beamercolorbox}
    \endgroup
}


\setbeamertemplate{section page}[mine]
\setbeamertemplate{subsection page}[mine]

\begin{document}


\title{QCQP: Progress Report}

\author{
  Chuwen Zhang
}


\maketitle
\begin{frame}{The QCQP}
  We consider the QCQP under a box constraint
  \begin{equation}
    \label{eq:inhoqcqp}
    \begin{aligned}
      \model{QCQP} \quad \mx \quad & x^T Qx + q^T x                                        \\
      \textrm{s.t.} \quad          & x^T A_i x + a_i^T x \hspace{0.27em} (\le, =, \ge) b_i \\
    \end{aligned}
  \end{equation}
  Alternatively, we may have \(\|x\| \le \delta\) or box \(x \in [0, 1]^n\)
\end{frame}
\begin{frame}[allowframebreaks]{Quadratic inequality with one negative/positive eigenvalue}
  Suppose \(Q = RR^T - aa^T\)

  For quadratic inquality,  it can be written as,

  \begin{equation*}
    x^TRR^Tx \le (a^Tx)^2
  \end{equation*}

  Then we natually solve the problem in two disjoint subregions, by \(a^Tx \ge 0 \vee  a^Tx \le 0 \),
  \begin{align*}
    (P1) \quad & \|R^Tx\| \le - a^Tx \\
    (P2) \quad & \|R^Tx\| \le a^Tx
  \end{align*}

  Implementation,
  \begin{itemize}
    \item Create offline subregions at depth 0 (multiple root nodes)
    \item Effective for quadratic inqualities.
  \end{itemize}

\end{frame}
\begin{frame}[allowframebreaks]{Max of quadratic function with one negative/positive eigenvalue}
  Consider maximization, (and assume Q has one positive eigenvalue)
  \begin{align*}
    \max \quad             & x^T(aa^T-RR^T)x + q^Tx           \\
    \Rightarrow \max \quad & z                                \\
    \st \quad              & z + x^TRR^Tx - q^Tx \le (a^Tx)^2
  \end{align*}

  We analyze,
  \begin{equation*}
    S = \{(z, x): x^TRR^Tx + z - q^Tx \le (a^Tx)^2\}
  \end{equation*}

  \begin{enumerate}
    \item Simply branch on \(sign(a^Tx)\) will prune one region very fast by bound.
    \item If using \red{best bound} rule in node selection, it has no obvious advantage.
  \end{enumerate}

  \begin{tabular}{llrrrrrl}
    \toprule
    {} & prob\_num & solve\_time & best\_bound & best\_obj & node\_time & nodes  & method    \\
    \midrule
    0  & 20:0:0    & 2.77        & 23.06       & 23.06     & 0.0000     & 3475.0 & grb       \\
    1  & 20:0:0    & 60.08       & 23.45       & 22.28     & 0.0072     & 2215.0 & bb\_sdp   \\
    2  & 20:0:0    & 0.37        & 23.07       & 23.06     & 0.0031     & 17.0   & bb\_msc   \\
    3  & 20:0:0    & 60.00       & 32.00       & 17.06     & 0.0040     & 6095.0 & bb\_nsocp \\
    \bottomrule
  \end{tabular}
  \framebreak

  \textbf{Alternatively}: branching on \(z - q^Tx\).

  \textbf{Case I}: if \(z - q^Tx \le 0\), then,
  \begin{align*}
                                           & x^TRR^Tx - \underbrace{(q^Tx - z)}_{\Delta \ge 0} = (a^Tx)^2 \\
    \text{Let: }\beta \ge 1 \Rightarrow \; & \red{\beta}\cdot \Delta\ge \|R^Tx\|^2                        \\
    \Rightarrow \;                         & \red{(\beta - 1)}\cdot\Delta \ge (a^Tx)^2
  \end{align*}

  Can be rewritten as two rotated cones,
  \begin{align*}
    \beta + \Delta     & \ge \left\|\begin{array}{c} 2R^Tx \\ \beta - \Delta \end{array}\right\| \\
    \beta - 1 + \Delta & \ge \left\|\begin{array}{c} 2a^Tx \\ \beta - 1 - \Delta \end{array}\right\| \\
  \end{align*}
  \framebreak

  \textbf{Case II}: if \(z - q^Tx \ge 0\),

  \begin{align*}
    x^TRR^Tx +     & \underbrace{(z - q^Tx)}_{\Delta \ge 0} = (a^Tx)^2      \\
                   & x^TRR^Tx + \red{\cancel{\Delta}} \le (a^Tx)^2          \\
    \Rightarrow \; & \underbrace{a^Tx \ge \|R^Tx\|}_{\textsf{subcase II.1}}
    \vee \underbrace{- a^Tx \ge \|R^Tx\|}_{\textsf{subcase II.2}}           \\
  \end{align*}


  This creates unbalanced subregions (same situation before.)

  \framebreak

  Try something similar to \textbf{Case I}

  \begin{align*}
    \beta \ge 1 \Rightarrow \; & \red{\beta}\cdot\Delta \ge (a^Tx)^2       \\
                               & \red{(\beta - 1)}\cdot\Delta \ge (R^Tx)^2 \\
                               & \red{\beta} \ge 1
  \end{align*}

  \(\Delta \doteq z - q^Tx\) is not bounded from above (we are maximizing \(z\))


  \begin{align*}
    \rho            & \ge (a^Tx)^2 \quad \dagger \\
    \rho  -  \Delta & \ge \|R^Tx\|^2             \\
  \end{align*}

  \(\rho\) is not bounded from above \(\dagger\) will not be tight.
  So the branch and bound is implemented on \(a^Tx \)
  % Then we branch by last solution \(\rho^*\)
  % \begin{equation*}
  %   a^Tx \le \sqrt{\rho^*} \vee a^Tx \le \sqrt{\rho^*}
  % \end{equation*}

\end{frame}


% \begin{frame}[allowframebreaks]{Bibliography}
%   \bibliography{headers/qcqp}
%   \bibliographystyle{apalike}
% \end{frame}
\end{document}
