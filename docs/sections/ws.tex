\documentclass[../main]{subfiles}
\title{Warm start}
\author{Chuwen Zhang}
\date{\today}
\begin{document}
\maketitle
{
    \setcounter{tocdepth}{3}
    \tableofcontents
}
\section{Warm start}
Recall primal dual SDP (Shor) relaxation.
\begin{equation}
    \begin{aligned}
        \model{Shor} \quad\mathrm{Maximize}\quad & Q\bullet Y   + q^T x                                             \\
        \mathrm{s.t.}  \quad                     & Y-xx^T \succeq 0 \text { or }\begin{bmatrix} 1 & x^{T} \\ x & Y \end{bmatrix} \succeq 0 \\
                                                 & 0\le x\le 1                                                      \\
    \end{aligned}
\end{equation}
For simplicity, we partition (extra) constraints into two subsets.
\begin{align}
    \label{eq.con.diag}    & \mathrm{diag}(Y) \le x                           \\
    \label{eq.con.regular} & A_i \bullet Y + a_i^Tx \; \le  \; b_i, \forall i
\end{align}
We mark \eqref{eq.con.diag} as diagonal constraint.
\begin{equation}
    \begin{aligned}
        \model{Dual-Shor} \quad \textrm{Minimize: }\quad & \lambda^Tb + \mu^Te + \alpha                   \\
        \mathrm{s.t.} \quad                              & Q = \sum_i \lambda_i A_i  + \diag(v)  -Z       \\
                                                         & \sum_i \lambda_i a_i + \mu - 2 y - v - q \ge 0 \\
                                                         & \begin{bmatrix}Z & y \\ y^T & \alpha\end{bmatrix} \succeq 0            \\
                                                         & \lambda, \mu, v \ge 0
    \end{aligned}
\end{equation}


\begin{lemma}
    (Unconstrained) Suppose \(m = 0\), our primal dual formulation reduces to,
    \begin{equation}
        \begin{aligned}
            \model{Shor} \quad\mathrm{Maximize}\quad & Q\bullet Y   + q^T x                                             \\
            \mathrm{s.t.}  \quad                     & Y-xx^T \succeq 0 \text { or }\begin{bmatrix} 1 & x^{T} \\ x & Y \end{bmatrix} \succeq 0 \\
                                                     & 0\le x\le 1                                                      \\
                                                     & \mathrm{diag}(Y) \le x
        \end{aligned}
    \end{equation}
    \begin{equation}
        \begin{aligned}
            \model{Dual-Shor} \quad \textrm{Minimize: }\quad & \mu^Te + \alpha                     \\
            \mathrm{s.t.} \quad                              & Q = \diag(v)  -Z                    \\
                                                             & \mu - 2 y - v - q \ge 0             \\
                                                             & \begin{bmatrix}Z & y \\ y^T & \alpha\end{bmatrix} \succeq 0 \\
                                                             & \mu, v \ge 0
        \end{aligned}
    \end{equation}
\end{lemma}


\subsection{Linear Cut}

Suppose we have primal \((x, Y)^{k}\) and dual \((\lambda, \mu, v, y, Z, \alpha)^k\) at some iteration \(k\). Assume the following valid inequality for the primal solutions,
\begin{equation*}
    B\bullet Y + c^T x \le e
\end{equation*}

The dual variable for the new problem \(\tilde\lambda\) has the following form,
\begin{equation}
    \tilde\lambda \equiv \begin{bmatrix}
        \lambda \\
        t
    \end{bmatrix}
\end{equation}

\begin{equation} \label{eq:ws.dual.linearc}
    \begin{aligned}
        \textrm{Minimize: }\quad & t \cdot e +  \lambda^Tb + \mu^Te + \alpha                  \\
        \mathrm{s.t.} \quad      & Q = t \cdot B + \sum_i \lambda_i A_i  + \diag(v)  - Z      \\
                                 & t \cdot c + \sum_i \lambda_i a_i + \mu - 2 y - v - q \ge 0 \\
                                 & \begin{bmatrix}Z & y \\ y^T & \alpha\end{bmatrix} \succeq 0                        \\
                                 & t, \lambda, \mu, v \ge 0
    \end{aligned}
\end{equation}

We see \eqref{eq:ws.dual.linearc} has a dummy feasible solution such that \((\begin{bmatrix}
    \lambda^k \\ 0\end{bmatrix}, \mu^k, v^k, y^k, Z^k, \alpha^k)\)

\subsubsection{RLT after Branching}
We consider the simple case within the branch and cut process. Suppose we pivot on a \(x_i^k\) which lies in the interior of \(\left[l_i + \epsilon, u_i -\epsilon\right]\) with small tolerance \(\epsilon \ge 0\).

The RLT cuts corresponding to bounds,
\begin{align}
    \label{eq:ws.rlt.left}  & Y_{ij} - u_i x_j - l_j x_i - l_j u_i \le 0 \\
    \label{eq:ws.rlt.right} & Y_{ij} - u_j x_i - l_i x_j - l_i u_j \le 0
\end{align}

\paragraph{Left child}
Consider the left child \(x_i \in [l_i, x_i^k < u_i]\), the lower bound is unchanged
\begin{itemize}
    \item Since \(x_i \le x_i^k\) is active, then \(x_i < 1, \mu_i = 0\)
\end{itemize}

\subsection{SDP based warmstart}

We first reformulate into standard SDP, by adding a slack \(d\) to diagonal constraint \eqref{eq.con.diag}, and \(s\) to the other constraints.


For diagonal constraint,
\begin{align*}
    \diag(Y) \le x & \Leftrightarrow e_ie_i^T \bullet Y - e_i^T x + d^Te + 0^Ts = 0                                 \\
                   & \Leftrightarrow e_ie_i^T \bullet Y - e_i^T x + e_i^T\diag(d)e_i + \bm 0^m \bullet \diag(s) = 0
\end{align*}

To ease our notation, let:
\begin{align*}
     & \tilde Y = \begin{bmatrix} Y             & x \\ x^T & 1 \end{bmatrix}; \tilde Q = \begin{bmatrix} Q & \frac{q}{2} \\ \frac{q^T}{2} & 0 \end{bmatrix} ; \\
     & \tilde E_i = \begin{bmatrix} e_ie_i^T  & -\frac{e_i}{2} \\ -\frac{e_i^T}{2} & 0 \end{bmatrix}, \forall i=1,\cdots,n;                 \\
     & \tilde A_i = \begin{bmatrix} A_i             & \frac{a_i}{2} \\ \frac{a_i^T}{2} & 0 \end{bmatrix}, \forall i=1,\cdots,m;
\end{align*}

Using SDP cone and linear cones,
\begin{equation} \label{eq:ws.std.primal}
    \begin{aligned}
        \mathrm{Maximize}\quad & \tilde Q \bullet \tilde Y                                                         \\
        \mathrm{s.t.} \quad    & \tilde Y  \in \mathscr S^{n+1}_+, d \in \mathbb{R}^n_+, s
        \in \mathbb{R}^m_+                                                                                         \\
                               & \begin{bmatrix}  \bm 0_n &  \\  & 1  \end{bmatrix} \bullet \tilde Y = 1                                   \\
                               & \tilde E_i \bullet \tilde Y + d_i = 0                     & \forall i=1,\cdots, n \\
                               & \tilde A_i \bullet \tilde Y + s_i = b_i                   & \forall i=1,\cdots, m \\
    \end{aligned}
\end{equation}

And dual form,

\begin{equation} \label{eq:ws.std.dual}
    \begin{aligned}
        \mathrm{Minimize} \quad & \alpha + b^Tx                                                    \\
        \mathrm{s.t.} \quad     & x \in \mathbb{R}^m, z\in \mathbb{R}^n, X  \in \mathscr S^{n+1}_+ \\
                                & X =\alpha \cdot \begin{bmatrix}  \bm 0_n &  \\  & 1  \end{bmatrix}
        + \sum_{i=1}^{n} z_{i} \tilde{E_i}
        + \sum_{i=1}^{m} x_{i} \tilde{A_i}
        - \tilde{Q}
    \end{aligned}
\end{equation}

KKT 

\subsubsection{Remark}
\paragraph{Feasible starting point} A
\paragraph{Pure SDP}
\eqref{eq:ws.std.primal} and \eqref{eq:ws.std.dual} can also be modeled by pure SDP cones.
\begin{equation}
    \begin{aligned}
         & \tilde n = n + 1 + (n + m)                                       \\
         & \tilde{Y} = \begin{bmatrix}
            xx^T & x &   &   \\
            x^T  & 1 &   &   \\
                 &   & d &   \\
                 &   &   & s
        \end{bmatrix}\in \mathscr S^{\tilde{n}}
    \end{aligned}
\end{equation}

And the constraints,
\begin{equation}
    x^TA_ix + a_i^Tx + e_i^T\diag(s)e_i = \tilde{Y} \bullet    \begin{bmatrix}
        A_i             & \frac{a_i}{2} &         &          \\
        \frac{a_i^T}{2} & 0             &         &          \\
                        &               & \bm 0_n &          \\
                        &               &         & e_ie_i^T
    \end{bmatrix} = b_i
\end{equation}

The standard form, homogeneous SDP,
\begin{equation}
    \begin{aligned}
        \mathrm{Maximize}\quad & \begin{bmatrix}
            Q & \frac{q}{2} & 0 \\ \frac{q^T}{2} & 0 & 0 \\ 0 & 0 & \bm 0_{m+n}
        \end{bmatrix} \bullet \tilde Y                               \\
        \mathrm{s.t.} \quad    & \tilde{Y}  \in \mathscr S^{\tilde{n}}_+                                   \\
                               & \begin{bmatrix}  \bm 0_n &  &  \\  & 1 &  \\  & & \bm 0_{m+n} \end{bmatrix} \bullet \tilde Y = 1                           \\
                               & \begin{bmatrix}
            e_ie_i^T         & -\frac{e_i}{2} &          &         \\
            -\frac{e_i^T}{2} & 0              &          &         \\
                             &                & e_ie_i^T &         \\
                             &                &          & \bm 0_m
        \end{bmatrix} \bullet \tilde Y = 0   & \forall i=1,\cdots, n \\
                               & \begin{bmatrix}
            A_i             & \frac{a_i}{2} &         &          \\
            \frac{a_i^T}{2} & 0             &         &          \\
                            &               & \bm 0_n &          \\
                            &               &         & e_ie_i^T
        \end{bmatrix}\bullet \tilde{Y} = b_i & \forall i=1,\cdots, m \\
    \end{aligned}
\end{equation}

Suppose we have a primal cut to \eqref{eq:ws.std.primal}:
\begin{equation*}
    B\bullet Y + c^T x \le \xi
\end{equation*}
\end{document}
