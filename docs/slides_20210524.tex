\include{headers/header.slides}
\usepackage{subfig}
\usepackage[style=verbose]{biblatex}
\usepackage{bm}
\title{Global QCQP Solver}
\author{Chuwen}
\date{\today}
\addbibresource{headers/qcqp.bib}


\begin{document}
\fontsize{8pt}{11.2}\selectfont
\frame{\titlepage}



\begin{frame}
  \frametitle{QCQP}
  Recall QCQP:

  \begin{equation}
    \begin{aligned}
      \mathrm{Maximize}\quad & x^TQx + q^T x                                   \\
      \mathrm{s.t.}  \quad   & x^{T} A_i x  + a_i^Tx   \; (\le, =, \ge) \; b_i \\
                             & 0\le x\le e
    \end{aligned}
  \end{equation}

  We apply ``Many-Small-Cone'' (MSC) relaxation and the second order cone programming (SOCP) relaxation.
\end{frame}

\begin{frame}{Many-Small-Cone: MSC}
  \begin{equation}
    \begin{aligned}
      \mathrm{Maximize}\quad              & (y^+)^Te - (y^-)^Te + q^Tx                                        \\
      \mathrm{s.t.} \quad                 & \begin{bmatrix}y^+_i & z^+_i \\ z^+_i & 1 \end{bmatrix} \succeq 0,
      \begin{bmatrix}y^-_i & z^-_i \\ z^-_i & 1 \end{bmatrix} \succeq 0 & \forall i                                                         \\
                                          & (U^+)^Tx = z^+, (U^-)^Tx = z^-                                    \\
                                          & \begin{bmatrix}Y^+_{j, i} & Z^+_{j, i}\\ Z^+_{j, i} & 1 \end{bmatrix} \succeq 0,
      \begin{bmatrix} Y^-_{j, i} & Z^-_{j, i} \\ Z^-_{j, i} & 1 \end{bmatrix} \succeq 0 & \forall j, \forall i                                              \\
                                          & (U^+_j)^Tx = Z^+_j, (U^-_j)^Tx = Z^-_j                & \forall j \\
                                          & (Y^+_j)^Te - (Y^-_j)^Te + a_j^Tx (\le, =, \ge) \; b_j & \forall j \\
    \end{aligned}
  \end{equation}

  where \(Q =  U^+ (U^+)^T - U^- (U^-)^T, A_j = U^+_j (U^+_j)^T - U^-_j (U^-_j)^T, j = 1,...,m\)
\end{frame}

\begin{frame}{MSC: A Stronger Formulation with Bounds}

  We take \(z^+, y^+\) for example, assuming \(0\le x\le e\)
  \begin{itemize}
    \item Since \(z^+_j = (Q^+_j)^T x\), \(Q^+_j\) is the \(j\)-th column of \(Q^+\)
    \item A naive bound can be established: (using \(0 \le x \le e\))
          \[\begin{aligned}
               & l^+_j = \sum_{i\in\{i: (Q^+_j)_i < 0\}} (Q^+_j)_i \\
               & u^+_j = \sum_{i\in\{i: (Q^+_j)_i > 0\}} (Q^+_j)_i \\
               & l^+_j < 0 \le z^+_j \le  u^+_j                    \\
               & y^+_j \le \max \{(l^+_j)^2, (u^+_j)^2\}
            \end{aligned}
          \]
    \item Bound for \((y^+)^T e\),
          \[(y^+)^T e \le \sum_{\{(i,j): P_{i,j} > 0 \}} P_{ij} \]
    \item And secant cuts for each and every \(z, y\) pairs.
  \end{itemize}

\end{frame}

\begin{frame}{MSC: Branching}
  Branch:
  As usual we branch on current solution at iteration \(k\), compute maximum ``infeasibility'',
  \[ \|y - z^2\|\]
  \begin{itemize}
    \item branch on \(z\):
          \[ \left(z \le z^k \right)  \vee \left(z \ge z^k \right)  \]
          % \item (*New) use the following branching since \(y \le z^2\) (cones already ensure the opposite):
          %       \[z \ge \sqrt{y}  \vee  z \le -\sqrt{y}
          %       \]
    \item branch on \(y\; \& z\):
          \[ \left(y \le y^k  \right)  \vee \left (y \ge y^k \right)  \]
          since we expect \(l \le y \le z^2\), (with \(y \ge z^2\) already satisfied by cones)
          where \(l\) is the lower bound of the corresponding child problem.

          It implies,
          \[
            \left(z \ge \sqrt{l} \right) \vee \left( z \le -\sqrt{l} \right)
          \]

          and thus it produces 4 child problems in the branching procedure.
          create too many children, need more sophisticated procedure.
    \item some greedy combinations. \textcolor{red}{didn't help much}
  \end{itemize}
\end{frame}

\begin{frame}{MSC: Connection to Large Cone}
  \begin{itemize}
    \item Suppose \(Y_s, x_s\) are solution by Shor relaxation (and thus an upper bound and lower bound if \(x_s\) feasible).
          \[e^Ty^+ - e^Ty^- +  q^Tx \le Q\bullet Y_s  + q^T x_s\]
          \textcolor{red}{Not used since Shor is needed}
    \item We notice, with auxillary \(d^+\), we can relax the MSC to a SOCP:
          \[\begin{aligned}
                          & d^+ (= e^Ty^+) \ge \|z^+\|^2                    \\
              \Rightarrow & (\frac{1}{2}, d^+, z^+) \in \mathcal{Q}^{n+2}_r
            \end{aligned}
          \]
          Similarly, the RLT or secant cuts:
          \[
            d - (l + u)^Tz + l^Tu \le 0
          \]
  \end{itemize}

\end{frame}

% \begin{frame}{SOCP}
%   \[\begin{aligned}
%       \mathrm{Maximize}\quad & d^+ - d^- + q^Tx                                                \\
%       \mathrm{s.t.} \quad    & (U^+)^Tx = z^+, (U^-)^Tx = z^-                                  \\
%                              & (U^+_j)^Tx = Z^+_j, (U^-_j)^Tx = Z^-_j              & \forall j \\
%                              & D^+_j - D^-_j +  a_j^Tx (\le, =, \ge) \; b_j        & \forall j \\
%                              & (\frac{1}{2}, d^+, z^+) \in \mathcal{Q}^{n+2}_r                 \\
%                              & (\frac{1}{2}, d^-, z^-) \in \mathcal{Q}^{n+2}_r                 \\
%                              & (\frac{1}{2}, D^+_j, Z^+_j) \in \mathcal{Q}^{n+2}_r & \forall j \\
%                              & (\frac{1}{2}, D^-_j, Z^-_j) \in \mathcal{Q}^{n+2}_r & \forall j \\
%     \end{aligned}\]

%   Using the same factorization method.
% \end{frame}

% \begin{frame}{SOCP: Branching}

%   \begin{itemize}
%     \item Extend branching method based on ``quadratic errors'', for every \((d, z, x)\),
%           \[ d - z^Tz\]
%           first pivot on \(d\) for largest error, by which we find some \(z\).

%   \end{itemize}
% \end{frame}

\begin{frame}{MSCA: MSC Alternative}

  Allow eigenvalue decomposition for \(Q\),
  \[x^TQx = \sum_j \lambda_j x^Tv_jv_j^Tx = \sum_j \lambda_j (x^Tv_j)^2\]

  So if we let \(z_i = x^Tv_i, y_i = z_i^2\), Take \(V\) as the matrix of \(v_i\) so we have \(z = V^Tx\),

  \[x^TQx = \lambda^Ty\]
\end{frame}

\begin{frame}{MSCA: MSC Alternative}

  This formulation improves MSC \textcolor{red}{a lot}.
  \begin{itemize}
    \item Since \(V\) is an orthonormal basis, we have,
          \[\|z\|^2 = \|x\|^2\]
          this allows,
          \[\sum_i y_i = z^Tz \le x^Tx\]
          the inequality is attained if \(V\) is of rank \(n\)
    \item Since \(\sum_i y_i \ge z^Tz\) by small cones, our goal is to reduce over-estimation of \(y_i\)
    \item RLT, Secant, branching, cuts, ..., anything from Shor also works here, but much faster.
  \end{itemize}
\end{frame}


\begin{frame}{MSCA: MSC Alternative2}

  Assume \(V\) is of rank \(n\),

  \[\begin{aligned}
       & \exists p, x = Vp                                                       \\
       & x^TQx = p^TV^TV\Gamma V^T Vp = p^T \Gamma p = \mathrm{diag}(\Gamma)^T y \\
       & 0 \le Vp \le e                                                          \\
       & \begin{bmatrix}y_i & p_i \\ p_i & 1 \end{bmatrix} \succeq 0
    \end{aligned}\]
  Also, \(p^Tp = x^Tx = y^Te\)
\end{frame}


\end{document}